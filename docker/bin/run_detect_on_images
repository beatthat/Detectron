#!/bin/bash

DIR=$(dirname "${BASH_SOURCE[0]}")  # get the directory name
DIR=$(realpath "${DIR}")    # resolve its full path if need be
DETECTRON_DEFAULT=$(dirname ${DIR})
IMAGE_DIR=$1
OUTPUT_DIR=$2
DETECTRON_DIR=${3:-$DETECTRON_DEFAULT}

echo "run_detect_on_images - DETECTRON_DIR=${DETECTRON_DIR}"

CONFIG=configs/12_2017_baselines/e2e_mask_rcnn_R-101-FPN_2x.yaml
IMG_EXT=jpg
WTS=https://s3-us-west-2.amazonaws.com/detectron/35861858/12_2017_baselines/e2e_mask_rcnn_R-101-FPN_2x.yaml.02_32_51.SgT4y1cO/output/train/coco_2014_train:coco_2014_valminusminival/generalized_rcnn/model_final.pkl


# python -c "import os, sys; print(os.environ['PYTHONPATH']); print(sys.path)"

python ${DETECTRON_DIR}/tools/infer_boxes_and_keypoints.py \
    --cfg ${CONFIG}  \
    --output-dir ${OUTPUT_DIR} \
    --image-ext ${IMG_EXT} \
    --wts ${WTS} \
    ${IMAGE_DIR}